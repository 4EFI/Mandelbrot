# Множество Мандельброта

## Что это?

Это множество таких c, для которых существует такое действительное R, что неравенство $| z_n | < R$ выполняется при всех натуральных n. Где $z_n$ - это рекуррентное соотношение: $z_{n+1} = z_n^2 + c$, $z_0 = 0$. 
Определение и название принадлежат французскому математику Адриену Дуади, в честь математика Бенуа Мандельброта.


<img src=img/image.png width="500px"/>


## Постановка задачи

В первую очередь мы должны программно получить множество Мандельброта и убедиться, что данный алгоритм требует большое количество вычислений, и как следствие выдает низкий FPS. Затем нам нужно оптимизировать проект, используя, как стандартные флаги компиляции, так и путем применения векторных инструкций, так и совместное использование SIMD и флагов оптимизации.  

## Компиляция 

Стоит отметить, что данный проект создавался на Linux и на других операционных системах процесс компиляции может завершиться ошибкой. Для того чтобы скомпилировать проект, вам потребуется библиотека SFML. Для Linux, пропишите команду:
~~~
sudo apt-get install libsfml-dev
~~~

После успешной установки библиотеки, клонируйте репозиторий к себе на компьютер: 
~~~
git clone https://github.com/4EFI/Mandelbrot.git
~~~

Можем перейти к компиляции, пропишите, находясь в главной директории проекта:
~~~
make clear
make    
~~~

## Запуск

Для того чтобы запустить исполняемый файл, пропишите:
~~~
./main
~~~

Если вы хотите протестировать программу с SSE, используйте следующую директиву в файле ./src/main.cpp
~~~
#define SSE
~~~

И выполните стадию компиляции, указанную выше. 

Также вы можете поставить нужные вам флаги оптимизации для компиляции. Для этого перейдите в SOURCES и добавьте их в переменную FFLAGS. 

## Представление 

Первым делом запустим наш проект без каких-либо флагов оптимизации и без AVX инструкций, мы получим следующую картинку в 1.6 FPS:


<img src=img/NO_OPT.png width="500px"/>

Давайте посмотрим как справится стандартный флаг оптимизации "-O3". На выходе мы получили значение в 3 FPS.

<details>
<summary> Множество Мандельброта </summary>
<img src=img/O3.png width="500px"/>
</details>
  
Теперь самое интересное - использование SIMD. Так как подсчет пикселей независим друг от друга, мы можем вести его сразу для 8 пикселей, упаковав их в соответствующий вектора и используя нужные нам интринсики. В конце концов, с оптимизацией AVX2 мы получаем 4.3 FPS:

<details>
<summary> Множество Мандельброта </summary>
<img src=img/SSE.png width="500px"/>
</details>
  
Давайте посмотрим, как поведет себя программа, если совместно с AVX мы воспользуемся флагом "-O3". Мы получаем значение в 15.2 FPS:

<details>
<summary> Множество Мандельброта </summary>
<img src=img/SSE_O3.png width="500px"/>
</details>
  
## Подведем итоги

Мы увидели, что отрисовка множества Мандельброта довольно вычислительно емкий процесс. Мы добились хороших результатов при оптимизации. Давайте сведем их в одну таблицу:

Версия  | Флаги | FPS  | Коэфф. Ускорения |
--------|-------|------|------------------|
без SSE |  Нет  | 1.6  |       0.53       |
без SSE |  -O3  | 3.0  |       1.00       |
  SSE   |  Нет  | 4.3  |       1.43       |
  SSE   |  -O3  | 15.2 |       5.06       |

Мы получили ускорение программы в 5 раз при использовании AVX с флагами оптимизации компилятора. Используя векторные инструкции в нашей программе, мы смогли добиться значительного повышения производительности по сравнению с реализациями без SIMD. Этот подход преимущественен по сравнению с использованием исключительно флагов оптимизации компилятора.

Также стоит отметить, что данный проект создавался на виртуальной машине, что является причиной столь низких FPS.  

