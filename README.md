# Множество Мандельброта

## Что это?

Это множество таких c, для которых существует такое действительное R, что неравенство $| z_n | < R$ выполняется при всех натуральных n. Где $z_n$ - это рекуррентное соотношение: $z_{n+1} = z_n^2 + c$, $z_0 = 0$. 
Определение и название принадлежат французскому математику Адриену Дуади, в честь математика Бенуа Мандельброта.


<img src=img/image.png width="500px"/>


## Постановка задачи

Первостепенно мы должны программно получить множество Мандельброта и убедиться, что данный алгоритм требует большое количество вычислений, и как следствие выдает низкий FPS. Затем нам нужно оптимизировать проект, используя, как стандартные флаги компиляции, такие как "-O3" или "-Ofast", так и путем применения SIMD инструкций.  

## Компиляция 

Стоит отметить, что данный проект создавался на Linux и на других операционных системах процесс компиляции может завершиться ошибкой. Для того чтобы скомпилировать проект, вам потребуется библиотека SFML. Для Linux, пропишите команду:
~~~
sudo apt-get install libsfml-dev
~~~

После успешной установки библиотеки, клонируйте репозиторий к себе на компьютер: 
~~~
git clone https://github.com/4EFI/Mandelbrot.git
~~~

Можем перейти к компиляции, пропишите, находясь в главной директории проекта:
~~~
make clear
make    
~~~

## Запуск

Для того чтобы запустить исполняемый файл, пропишите:
~~~
./main
~~~

Если вы хотите протестировать программу с SSE, используйте следующую директиву в файле ./src/main.cpp
~~~
#define SSE
~~~

И выполните стадию компиляции, указанную выше. 

Также вы можете поставить нужные вам флаги оптимизации для компиляции. Для этого перейдите в SOURCES и добавьте их в переменную FFLAGS. 

## Анализ 

Без какой-либо оптимизации, мы получаем следующую картинку в 1.5 FPS:

<img src=img/NO_OPT.png width="500px"/>

Если мы скомпилируем проект с флагом -O3, мы получаем 3 FPS, что уже в 2 раза быстрее, чем без какой-либо оптимизации:

<img src=img/O3.png width="500px"/>

Теперь самое интересное - использование SIMD'ов. SIMD, в переводе на русский, - это одиночный поток команд, множественный поток данных. Мы будем вычислять значение сразу 8 пикселей, используя нужные нам интринсики и хранить их в соответствующих векторах. В конце концов, с оптимизацией AVX2 мы получаем 5 FPS, что уже в 3.3 раза больше, чем в первоначальном варианте:

<img src=img/SSE.png width="500px"/>

Используя флаг -O3 и AVX2, мы получаем 15 FPS, а это уже ускорение в 10 раз:

<img src=img/SSE_O3.png width="500px"/>

## Подведем итоги

Мы увидели, что отрисовка множества Мандельброта довольно вычислительно емкий процесс. Мы добились хороших результатов при оптимизации. Давайте сведем их в одну таблицу:

| Оптимизация | FPS  | коэфф. ускорение |
|-------------|------|------------------|
|     Нет     | 1.6  |       0.53       |
|     -O3     | 3.0  |       1.00       |
|     AVX2    | 4.3  |       1.43       |
|   AVX2 -O3  | 15.2 |       5.06       |

Также стоит отметить, что данный проект создавался на виртуальной машине, что является причиной столь низких FPS.  

